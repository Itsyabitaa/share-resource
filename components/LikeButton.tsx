import { useState } from 'react'\nimport { useTheme } from '../lib/ThemeContext'\nimport { useRouter } from 'next/router'\n\ninterface LikeButtonProps { \n  fileId: string\n  initialLikeCount: number\n  initialUserHasLiked: boolean\n  isAuthenticated: boolean\n } \n\nexport default function LikeButton({ \n  fileId, \n  initialLikeCount, \n  initialUserHasLiked, \n  isAuthenticated \n }: LikeButtonProps) { \n  const [likeCount, setLikeCount] = useState(initialLikeCount) \n  const [userHasLiked, setUserHasLiked] = useState(initialUserHasLiked) \n  const [isLoading, setIsLoading] = useState(false) \n  const { colors } = useTheme() \n  const router = useRouter() \n\n  const handleLike = async () => { \n    if (!isAuthenticated) { \n      // Redirect to login\n      router.push('/login?redirect=' + encodeURIComponent(router.asPath))\n      return\n    }\n\n    if (isLoading) return\n\n    // Optimistic update\n    const previousLiked = userHasLiked\n    const previousCount = likeCount\n    setUserHasLiked(!userHasLiked)\n    setLikeCount(userHasLiked ? likeCount - 1 : likeCount + 1)\n    setIsLoading(true)\n\n    try {\n      const response = await fetch('/api/likes', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ fileId })\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to toggle like')\n      }\n\n      const data = await response.json()\n      setLikeCount(data.likeCount)\n      setUserHasLiked(data.userHasLiked)\n    } catch (error) {\n      console.error('Error toggling like:', error)\n      // Revert optimistic update\n      setUserHasLiked(previousLiked)\n      setLikeCount(previousCount)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <button\n      onClick={handleLike}\n      disabled={isLoading}\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n        gap: '8px',\n        padding: '10px 16px',\n        backgroundColor: userHasLiked ? colors.primary : colors.inputBackground,\n        color: userHasLiked ? '#fff' : colors.text,\n        border: `1px solid ${userHasLiked ? colors.primary : colors.border}`,\n        borderRadius: '8px',\n        cursor: isLoading ? 'wait' : 'pointer',\n        fontSize: '14px',\n        fontWeight: '500',\n        transition: 'all 0.2s ease',\n        opacity: isLoading ? 0.7 : 1\n      }}\n      onMouseEnter={(e) => {\n        if (!isLoading) {\n          e.currentTarget.style.transform = 'scale(1.05)'\n        }\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.transform = 'scale(1)'\n      }}\n      title={isAuthenticated ? (userHasLiked ? 'Unlike' : 'Like') : 'Login to like'}\n    >\n      <span style={{ fontSize: '18px' }}>\n        {userHasLiked ? '‚ù§Ô∏è' : 'ü§ç'}\n      </span>\n      <span>{likeCount} {likeCount === 1 ? 'Like' : 'Likes'}</span>\n    </button>\n  )\n}\n
